
---

## 🧠 CGNTM – Causal Graph Neural Topic Model

CGNTM is a **causal topic discovery model** that integrates large language models (LLM), structural causal modeling (SCM), graph neural networks (GNN), and generative adversarial training (WGAN). It is used to build topic hierarchical structures and causal graphs from unlabeled text and supports counterfactual text generation.

---

## 📁 Project Structure

```
├── causal_gnn.py             
├── cluster.py                
├── consistency_loss.py          
├── discriminator.py      
├── evaluate.py               
├── graph_builder.py          
├── hierarchical_gnn.py       
├── llm_extraction.py        
├── neural_scm.py             
├── train.py                  
├── wgan_generator.py         
├── requirements.txt
└── README.md
```

---

## ⚙️ Environment Setup

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

---

## 🗂️ Input Data Requirements

Place the following files in the `data/` directory:

* `pub.csv`: Raw text (columns: `pmid`, `title`, `abstract`)

* `pub_causal_triplets.json`: Generated by `llm_extraction.py`, includes:

  ```json
  [{"keywords": ["lung cancer", "mutation", ...],
    "causal_relations": [{"cause": "smoking", "effect": "lung cancer"}, ...]}]
  ```

---

## 🚀 Running Process

Execute the following commands in order:

```bash
# Step 1: Generate triplets and keywords from LLM
python llm_extraction.py

# Step 2: Build causal graph DAG + predict edges
python graph_builder.py --root_dir .

# Step 3 (Optional): Generate node clustering structure (for hierarchical GNN)
python cluster.py --data_dir data/ -k 6

# Step 4: Write title+abstract to corpus file (one per line)
python export_corpus.py             # You can customize this script

# Step 5: Joint training: SCM + G + D + HGNN
python train.py --gpu

# Step 6: Evaluate: Node intervention + five metrics (if files are complete)
python evaluate.py --metrics --target "cigarette smoking" --report metrics.json
```

---

## 📊 Evaluation Metrics

The `evaluate.py` script can output the following metrics used in the paper:

| Metric   | Description                                                                                             |
| -------- | ------------------------------------------------------------------------------------------------------- |
| **NPMI** | Semantic consistency between topic keywords                                                             |
| **TD**   | Topic Diversity: Coverage of different topic words                                                      |
| **CP**   | Causal Precision: Whether predicted edges align with knowledge base direction                           |
| **RCR**  | Reverse Causality Rate: Rate of incorrect reverse predictions                                           |
| **CSA**  | Counterfactual Semantic Alignment: Semantic consistency before and after generating counterfactual text |

These metrics depend on the following files:

| File                    | Source Script                                |
| ----------------------- | -------------------------------------------- |
| `eval/topic_words.json` | `llm_extraction.py`                          |
| `eval/corpus.txt`       | `export_corpus.py`                           |
| `eval/pred_edges.txt`   | `graph_builder.py`                           |
| `eval/true_edges.txt`   | Manually prepared or external knowledge base |
| `eval/embeddings.npz`   | `train.py` auto-generated                    |

---

## ✅ Training Output File Structure

```text
data/
 ├ causal_graph.npy       
 ├ node_names.json
 └ cluster_ids.npy       

models/
 ├ scm_joint.pth
 ├ g_joint.pth
 ├ d_joint.pth
 ├ hgnn_joint.pth
 └ latent.pt             

eval/
 ├ pred_edges.txt
 ├ true_edges.txt
 ├ topic_words.json
 ├ corpus.txt
 └ embeddings.npz
```

---

## 🧩 Dependencies

Main dependencies include:

* `torch`, `transformers`, `scikit-learn`, `matplotlib`
* Recommended version: `networkx>=3.0`, `tqdm`

For the full list, see `requirements.txt`.

---

